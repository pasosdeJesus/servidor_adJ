<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>MariaDB</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="La distribución Aprendiendo de Jesús como servidor y cortafuegos"
HREF="book1.htm"><LINK
REL="UP"
TITLE="Otros servicios que puede prestar el servidor"
HREF="c2405.htm"><LINK
REL="PREVIOUS"
TITLE="Motor de bases de datos PostgreSQL"
HREF="x2451.htm"><LINK
REL="NEXT"
TITLE="Servidor ldapd"
HREF="x2747.htm"></HEAD
><BODY
CLASS="sect1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>La distribución Aprendiendo de Jesús como servidor y cortafuegos</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="x2451.htm"
ACCESSKEY="P"
>Anterior</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>Capítulo 6. Otros servicios que puede prestar el servidor</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="x2747.htm"
ACCESSKEY="N"
>Siguiente</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="mariadb"
>MariaDB</A
></H1
><P
>A partir de OpenBSD/adJ 5.7 MariaDB remplaza a MySQL.  Según 
		<A
HREF="https://es.wikipedia.org/wiki/MariaDB"
TARGET="_top"
>https://es.wikipedia.org/wiki/MariaDB</A
> MariaDB fue
		iniciada por el fundador de MySQL después de que Oracle 
		compró Sun y MySQL, pues consideraba que Oracle había
		hecho la compra para reducir competencia de sus bases 
		de datos.</P
><P
>Debe instalar los paquetes mariadb-client-10.0.16v0 y
	  mariadb-server-10.0.16v0. Aunque el nombre de los paquetes cambia
	  los comandos para operarla siguen siendo los mismos.
	  Tras instalar el servidor debe
      ejecutar <B
CLASS="command"
>mysql_install_db</B
>.  
  </P
><P
>&#13;      Inicialice el directorio donde estarán las bases de datos con
<PRE
CLASS="screen"
>&#13;	doas /usr/local/bin/mysql_install_db
</PRE
>
</P
><P
>&#13;	  Para aumentar el límite de archivos que el usuario 
	  <TT
CLASS="literal"
>_mysql</TT
> de clase <TT
CLASS="literal"
>mysql</TT
> puede abrir
	  agregue a <TT
CLASS="filename"
>/etc/login.conf</TT
>:
<PRE
CLASS="screen"
>&#13;	mysql:\
		:openfiles-cur=2048:\
		:openfiles-max=4096:\
		:tc=daemon:
</PRE
>
tenga en cuenta no dejar espacios al 
final de cada línea y que desde la segunda línea cada una comiencen con el caracter
tabulador. A continuación regenere el archivo binario  
<TT
CLASS="filename"
>/etc/login.conf.db</TT
> con
<PRE
CLASS="screen"
>&#13;	cd /etc
	doas cap_mkdb /etc/login.conf 
</PRE
>
Después agregue <TT
CLASS="literal"
>mysqld</TT
> a 
<TT
CLASS="literal"
>pkg_scripts</TT
> en <TT
CLASS="filename"
>/etc/rc.conf.local</TT
>.
A continuación lance el servidor con:
<PRE
CLASS="screen"
>&#13;	doas sh /etc/rc.d/mysqld start
</PRE
>
Los errores quedarán en <TT
CLASS="filename"
>/var/mysql/<TT
CLASS="replaceable"
><I
>host</I
></TT
>.err</TT
>.
</P
><P
>&#13;    Después puede establecer una clave para el usuario
    <TT
CLASS="literal"
>root</TT
> de MariaDB cuando ingresa desde
    <TT
CLASS="literal"
>localhost</TT
> con:
<PRE
CLASS="screen"
>&#13;	/usr/local/bin/mysqladmin -u root  password 'nueva-clave' 
	/usr/local/bin/mysqladmin -u root -pnueva-clave -h Jesus.miescuela.edu.co password 'nueva-clave'
    </PRE
>
    Después puede iniciar una sesión, crear bases de datos, crear usuarios
    y otorgarles privilegios.
    </P
><P
>Para apagar el servidor mysql:
<PRE
CLASS="screen"
>&#13;	mysqladmin -u root -p shutdown
    </PRE
>
  </P
><P
>Si desea usar <SPAN
CLASS="application"
>mysql</SPAN
> con
    <SPAN
CLASS="application"
>php</SPAN
>, instale además de los paquetes
    básicos de php
    (<TT
CLASS="filename"
>php-core-<TT
CLASS="replaceable"
><I
>v</I
></TT
></TT
> y
    <TT
CLASS="filename"
>php-mysql-<TT
CLASS="replaceable"
><I
>v</I
></TT
></TT
>)
  </P
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="uso-mariadb"
>Uso básico</A
></H2
><P
>&#13;<PRE
CLASS="screen"
>&#13;	mysql -u root -p 
</PRE
>
    puede crear la base de datos <TT
CLASS="literal"
>datos</TT
>, y un
    usuario <TT
CLASS="literal"
>erfurt</TT
> que la pueda administrar (i.e
		    con todos los privilegios excepto GRANT) y con clave
    <TT
CLASS="literal"
>vsewf</TT
> usando:
<PRE
CLASS="screen"
>&#13;	CREATE DATABASE datos;
	GRANT ALL PRIVILEGES ON datos.* TO erfurt@localhost IDENTIFIED BY 'vsewf';
</PRE
>
    </P
><P
>&#13;    Algunas operaciones usuales del administrador son:
<PRE
CLASS="screen"
>&#13;	SHOW DATABASES;
</PRE
>
que muestra todas las bases disponibles.
<PRE
CLASS="screen"
>&#13;	USE base1;
</PRE
>
    que permite usar la base base1.
<PRE
CLASS="screen"
>&#13;	SHOW TABLES;
</PRE
>
    que muestra todas las tablas de la base activa.
<PRE
CLASS="screen"
>&#13;	DESCRIBE tabla;
	SHOW CREATE TABLE tabla;
</PRE
>
    que presentan estructura de la tabla.

    </P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="clave-mysql"
>Cambio de la clave de administrador</A
></H2
><P
>Si olvida la clave de root después de haberla establecido 
    puede cambiarla entrando a la cuenta de administrador:
    <P
></P
><UL
><LI
><P
>Detenga el servidor.</P
></LI
><LI
><P
>Inicie el servidor con 
		<B
CLASS="command"
>/usr/local/libexec/mysqld --user=root --skip-grant-tables</B
></P
></LI
><LI
><P
>Ejecute:
<PRE
CLASS="screen"
>&#13;	# mysql
	mysql&#62; USE mysql
	mysql&#62; UPDATE USER SET PASSWORD=password('miclave') WHERE user='root';
	mysql&#62; FLUSH PRIVILEGES;
	mysql&#62; EXIT
</PRE
></P
></LI
><LI
><P
>Vuelva a apagar el servidor y reinicielo con:
	  <B
CLASS="command"
>/usr/local/bin/mysqld_safe &#38;</B
>
	</P
></LI
></UL
>
  </P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="recuperacion-backups"
>Recuperación y backups</A
></H2
><P
>&#13;	  MariaDB mantiene bases de datos en directorios y las tablas 
	  en archivos.  No es recomendable que modifique tales archivos,
	  al menos no, mientras el servidor esté activo.  
  </P
><P
>&#13;	  Para sacar una copia de respaldo de todas las bases de datos con:
<PRE
CLASS="screen"
>&#13;	mysqldump --force -p --all-databases &#62; /respaldomysql/dump-1nov2007.sql
</PRE
>
	  y posteriormente restaurarla con:
<PRE
CLASS="screen"
>&#13;	mysql &#60; /respaldomysql/dump-1nov2007.sql
</PRE
>
  </P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="chroot-mysql"
>MariaDB y servidor web con chroot</A
></H2
><P
>Puede emplear aplicaciones para Apache en modo
		  <TT
CLASS="literal"
>chroot</TT
> que usen bases de datos 
		  MariaDB de tres formas:
		  (1) Conectándose a un puerto TCP/IP donde responda
		  MariaDB, (2) poniendo el socket de MariaDB en un directorio
		  dentro de la jaula del servidor web o (3) Corriendo MariaDB 
		  dentro de la jaula
		  <TT
CLASS="literal"
>chroot</TT
> (ver <A
HREF="http://structio.sourceforge.net/guias/servidor_OpenBSD/mysql.html#mysql-chroot"
TARGET="_top"
>http://structio.sourceforge.net/guias/servidor_OpenBSD/mysql.html#mysql-chroot</A
>).  </P
><P
>&#13;		  Para correro MariaDB dentro de
		  A continuación documentamos como 
		  ubicar el socket de MariaDB dentro de la jaula
		  del servidor web (/var/www/).
	  </P
><P
>&#13;			  Una vez instale <TT
CLASS="literal"
>maria-server</TT
> 
			  cree el directorio en el cual ubicará
			  el socket, digamos:
<PRE
CLASS="screen"
>&#13;	mkdir -p /var/www/var/run/mysql/
	chown _mysql:_mysql /var/www/var/run/mysql/
	chmod a+w /var/www/var/run/mysql/
	chmod +t /var/www/var/run/mysql/
</PRE
>
			  y después inicie MariaDB indicando la ruta del
			  socket con la opción <TT
CLASS="literal"
>--socket</TT
>,
			  por ejemplo para que el cambio se efectúe en
			  cada inicio, edite 
			  <TT
CLASS="filename"
>/etc/rc.conf.local</TT
> para
			  agregar:
<PRE
CLASS="screen"
>&#13;	mysqld_flags="--socket=/var/www/var/run/mysql/mysql.sock"
</PRE
>
e inicie desde <TT
CLASS="filename"
>/etc/rc.local</TT
>
con:
<PRE
CLASS="screen"
>&#13;	pgrep mysqld &#62; /dev/null
	if [ "$?" != 0  -a X"${mysqld_flags}" != X"NO" -a \
		-x /usr/local/bin/mysqld_safe ]; then
		echo -n ' mysqld ' 
		/usr/local/bin/mysqld_safe ${mysqld_flags} &#38;
	fi
</PRE
>

Sus aplicaciones PHP pueden entonces conectarse con:
<PRE
CLASS="screen"
>&#13;	$dbhost  = "localhost";
	$dbuname = "miusuario";
	$dbpass  = "miclave";
	mysql_connect($dbhost, $dbuname, $dbpass);
</PRE
>
</P
><P
>Tenga en cuenta también que otros binarios de MariaDB también requerirán
	la opción <TT
CLASS="literal"
>--socket=/var/www/var/run/mysql/mysql.sock</TT
>
	al ejecutarse por ejemplo:
<PRE
CLASS="screen"
>&#13;	mysqldump --socket=/var/www/var/run/mysql/mysql.sock  
		\-p --all-databases
	</PRE
>
		  </P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="lecutras-mysql"
>Lecturas recomendadas</A
></H2
><P
>&#13;    Referencias:
    <P
></P
><UL
><LI
><P
>Una explicación de algo de la instalación y el uso de 
	  MySQL en OpenBSD: 
	  <A
HREF="http://www.sancho2k.net/filemgmt_data/files/mysql_notes.html"
TARGET="_top"
>http://www.sancho2k.net/filemgmt_data/files/mysql_notes.html</A
>
	</P
></LI
><LI
><P
>La documentación de MariaDB : 
	  <A
HREF="https://mariadb.com/kb/en/mariadb/documentation/"
TARGET="_top"
>https://mariadb.com/kb/en/mariadb/documentation/</A
>
	</P
></LI
><LI
><P
>Ayuda para cambiar clave de root en sistemas Linux:
	  <A
HREF="http://www.netadmintools.com/art90.html"
TARGET="_top"
>http://www.netadmintools.com/art90.html</A
>
	</P
></LI
></UL
>

  </P
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="x2451.htm"
ACCESSKEY="P"
>Anterior</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="book1.htm"
ACCESSKEY="H"
>Inicio</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="x2747.htm"
ACCESSKEY="N"
>Siguiente</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Motor de bases de datos PostgreSQL</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="c2405.htm"
ACCESSKEY="U"
>Subir</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Servidor ldapd</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>