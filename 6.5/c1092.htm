<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Protocolos de soporte y de usuario</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="La distribución Aprendiendo de Jesús como servidor y cortafuegos"
HREF="book1.htm"><LINK
REL="PREVIOUS"
TITLE="Control de ancho de banda"
HREF="x1076.htm"><LINK
REL="NEXT"
TITLE="Servidor ssh"
HREF="x1194.htm"></HEAD
><BODY
CLASS="chapter"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>La distribución Aprendiendo de Jesús como servidor y cortafuegos</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="x1076.htm"
ACCESSKEY="P"
>Anterior</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="x1194.htm"
ACCESSKEY="N"
>Siguiente</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="chapter"
><H1
><A
NAME="protocolos-soporte-usuario"
></A
>Capítulo 5. Protocolos de soporte y de usuario</H1
><DIV
CLASS="TOC"
><DL
><DT
><B
>Tabla de contenidos</B
></DT
><DT
><A
HREF="c1092.htm#servidor-dns"
>Servidor DNS</A
></DT
><DT
><A
HREF="x1194.htm"
>Servidor <B
CLASS="command"
>ssh</B
></A
></DT
><DT
><A
HREF="x1219.htm"
>Protocolo <B
CLASS="command"
>DHCP</B
></A
></DT
><DT
><A
HREF="x1263.htm"
>Servidor <B
CLASS="command"
>ntp</B
></A
></DT
><DT
><A
HREF="x1278.htm"
>Servidor de correo electrónico</A
></DT
><DT
><A
HREF="x2002.htm"
>Servidor <TT
CLASS="literal"
>ftp</TT
></A
></DT
><DT
><A
HREF="x2050.htm"
>Servidor Web</A
></DT
></DL
></DIV
><P
></P
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="servidor-dns"
>Servidor DNS</A
></H1
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="resolucion-de-nombres"
>Resolución de nombres</A
></H2
><P
>Para resolver nombres OpenBSD emplea rutinas propias
      de resolución incluidas en la librería de C, se configuran
      en <TT
CLASS="filename"
>/etc/resolv.conf</TT
>.  Este archivo
      puede incluir, dominio (<TT
CLASS="literal"
>domain</TT
>),
      lista de servidores (<TT
CLASS="literal"
>nameserver</TT
>),  orden de fuentes 
      donde buscar (<TT
CLASS="literal"
>lookup</TT
>), lista de dominios en los
      cuales buscar (<TT
CLASS="literal"
>search</TT
>), 
      retornar direcciones IP en orden (<TT
CLASS="literal"
>sortlist</TT
>),
      opciones (<TT
CLASS="literal"
>options</TT
>).   Un ejemplo del
      archivo <TT
CLASS="filename"
>/etc/resolv.conf</TT
> es:
      <PRE
CLASS="screen"
>&#13;search miescuela.edu.co
nameserver 192.168.16.1
lookup file bind
      </PRE
>
      <TT
CLASS="literal"
>lookup</TT
> permite especificar un orden para
      hacer resolución de acuerdo a uno o más de los siguientes 
      argumentos separados por espacio:
      <P
></P
><UL
><LI
><P
><TT
CLASS="literal"
>bind</TT
> que indica usar servidor de nombres
	    (<TT
CLASS="literal"
>named</TT
>)</P
></LI
><LI
><P
><TT
CLASS="literal"
>file</TT
> que indica buscar en
	    <TT
CLASS="filename"
>/etc/hosts</TT
></P
></LI
><LI
><P
><TT
CLASS="literal"
>yp</TT
> que indica emplear el sistema YP si
	    <B
CLASS="command"
>ypbind</B
> está corriendo.</P
></LI
></UL
>
    </P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="named"
>named</A
></H2
><P
>OpenBSD incluye entre sus componentes básicos parte del servidor
      BIND 9, bajo el nombre <TT
CLASS="literal"
>named</TT
>, que por defecto corre
      con <B
CLASS="command"
>chroot</B
> en el directorio
      <TT
CLASS="filename"
>/var/named</TT
>.  
    </P
><P
>Puede configurarse y probarse antes de iniciarlo en cada
      arranque.  Para configurarlo por primera vez pueden seguirse primero 
      los pasos de <TT
CLASS="filename"
>/etc/rc</TT
>.
      El archivo de configuración es
      <TT
CLASS="filename"
>/var/named/etc/named.conf</TT
>.  Se sugiere
      que se agregue información de zonas de las cuales es maestro en
      en archivos del directorio
      <TT
CLASS="filename"
>/var/named/master</TT
>.
      Pueden configurarse archivos como dice en [<SPAN
CLASS="citation"
><A
HREF="b2933.htm#AA_Linux"
>AA_Linux</A
></SPAN
>]
      por ejemplo los datos un servidor DNS primario del dominio miescuela.edu.co 
      pueden quedar en el archivo 
      <TT
CLASS="filename"
>/var/named/master/miescuela.edu.co</TT
>:
      <PRE
CLASS="screen"
>&#13;$TTL 1D
@ IN  SOA  @  root.localhost. (
	03091025 ; Serial
	1D   ; Refresco secundario
	6H   ; Reintento secundario
	2D   ; Expiración secundaria
	1D ) ; Cache de registro de recursos

	NS  @

	A       65.8.9.234

	MX      5      correo.miescuela.edu.co.

correo	IN      A       201.2.3.74
ns1     IN      A       201.2.3.74
www     IN      A       201.2.3.74
</PRE
>

Note que se declara el mismo dominio como servidor de nombre autoritario,
se relaciona con la IP (65.8.9.234), el nombre
<TT
CLASS="literal"
>correo.miescuela.edu.co</TT
> identificara la misma máquina
y es el nombre que se usará para intercambiar correos; el nombre
<TT
CLASS="literal"
>www.miescuela.edu.co</TT
> será un alias para el mismo servidor.
Note que todo nombre que no termine con punto (.), será completado por
<B
CLASS="command"
>bind</B
> con el dominio (i.e <TT
CLASS="literal"
>www</TT
> será 
completado a
<TT
CLASS="literal"
>www.miescuela.edu.co</TT
>, si se olvida el punto después
de <TT
CLASS="literal"
>correo.miescuela.edu.co</TT
>, <B
CLASS="command"
>bind</B
> lo 
completará a
<TT
CLASS="literal"
>correo.miescuela.edu.co.miescuela.edu.co</TT
>).
Recuerde aumentar el número serial cada vez que haga algún cambio, para que
la información pueda ser actualizada en los servidores secundarios.
Puede probar cada archivo de zonas que haga con:
<PRE
CLASS="screen"
>&#13;  named-checkzone miescuela.edu.co /var/named/master/miescuela.edu.co
</PRE
>
Agregue una referencia al archivo de zonas maestro en
<TT
CLASS="filename"
>/var/named/etc/named.conf</TT
>, en la sección para
zonas maestras algo de la forma:
<PRE
CLASS="screen"
>&#13;zone "miescuela.edu.co" {
  type master;
  file "master/miescuela.edu.co";
}
</PRE
>
</P
><P
>&#13;Si desea que un servidor sea secundario de algún servidor primario,
agregue en <TT
CLASS="filename"
>/var/named/etc/named.conf</TT
> en la sección
para zonas esclavas algo como:
<PRE
CLASS="screen"
>&#13;zone "miescuela.edu.co" {
  type slave;
  file "slave/miescuela.edu.co";
  masters { 65.8.9.234; };
}
</PRE
>

Cuando <B
CLASS="command"
>named</B
> lea de nuevo sus archivos de configuración 
traerá la información del servidor primario y la dejará en el archivo
<TT
CLASS="filename"
>/var/named/slave/miescuela.edu.co</TT
>.
</P
><P
>&#13;      El servidor se inicia con
      <PRE
CLASS="screen"
>&#13;    sudo sh /etc/rc.d/named start</PRE
>
      Los errores que se produzcan antes de hacer <B
CLASS="command"
>chroot</B
>
      son enviados a <TT
CLASS="filename"
>/var/log/servicio</TT
>.
      Para probar el funcionamiento antes de modificar
      <TT
CLASS="filename"
>/etc/resolv.conf</TT
> puede usar:
      <PRE
CLASS="screen"
>&#13;	dig @localhost miescuela.edu.co
      </PRE
>
      Si requiere volver a leer los archivos de configuración 
      (por ejemplo después de cambiar los archivos de zonas) puede
      enviar la señal <TT
CLASS="literal"
>SIGHUP</TT
> al proceso con:
      <PRE
CLASS="screen"
>&#13;	pkill -HUP named
      </PRE
>
      o con
      <PRE
CLASS="screen"
>&#13;	rndc reload
      </PRE
>
    </P
><P
>&#13;      Una vez compruebe que su servidor DNS está operando correctamente puede
      indicar que se inicie en cada arranque agregando a
      <TT
CLASS="filename"
>/etc/rc.conf.local</TT
>:
      <PRE
CLASS="screen"
>&#13;named_flags="" </PRE
>
      y en el mismo archivo en la definición de <TT
CLASS="literal"
>pkg_scripts</TT
>
      agregando <TT
CLASS="literal"
>named</TT
>.
    </P
><DIV
CLASS="sect3"
><H3
CLASS="sect3"
><A
NAME="vistas"
>Vistas para resolver nombres interna y externamente</A
></H3
><P
>Si cuenta con una LAN conectada a Internet por medio
		    de un cortafuegos con OpenBSD que maneja el DNS
		   	de su organización  y si además cuenta
		    con una DMZ tal que las peticiones a algunos puertos
		    del cortafuegos son redirigidas a uno o más servidores,
		    seguramente tendrá inconvenientes al resolver
		    nombres de su dominio en la LAN, pues el nombre de 
		    su organización
		    (digamos miescuela.edu.co) será resulto a la dirección externa,
		    la cual conectará al cortafuegos por el puerto
		    pedido y tratará de redirigir la conexión al
		    servidor en la DMZ (i.e se reflejará).   Por este motivo
		    desde su LAN en general no resolverá nombres de su dominio.
	    </P
><P
>Una solución 
            (ver <TT
CLASS="filename"
>/var/named/etc/named-dual.conf</TT
>)  es 
            configurar 
		    <SPAN
CLASS="application"
>bind</SPAN
> para que tenga dos
		    vistas, una para computadores fuera de la LAN y otra
		    para computadores dentro de la LAN.  Un posible
		    archivo de configuración (basado en los distribuidos
		    con OpenBSD) es:
		    <PRE
CLASS="screen"
>&#13;acl clients {
	localnets;
	::1;
};
options {
	version "";     
	listen-on    { any; };
	listen-on-v6 { any; };
	allow-recursion { clients; };
};
logging {
	category lame-servers { null; };
};

view "internal" {  // Para la red interna
    match-clients { clients; };
    match-recursive-only yes;
    recursion yes;

    zone "." {
    	type hint;
    	file "standard/root.hint";
    };
    zone "localhost" {
    	type master;
	file "standard/localhost";
	allow-transfer { localhost; };
    }
    zone "127.in-addr.arpa" {
    	type master;
    	file "standard/loopback";
    	allow-transfer { localhost; };
    };
    zone "0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.ip6.arpa" {
    	type master;
    	file "standard/loopback6.arpa";
    	allow-transfer { localhost; };
    };
    zone "com" {
    	type delegation-only;
    };
    zone "net" {
    	type delegation-only;
    };

    zone "miescuela.edu.co" {
        type master;
        file "refleja/miescuela.edu.co.org";
    };
};
view "external" { // Para Internet
    recursion no;
    additional-from-auth no;
    additional-from-cache no;
    zone "miescuela.edu.co" {
        type master;
	file "master/miescuela.edu.co";
    };
    zone "168.74.245.200.IN-ADDR.ARPA" { // Para resolución inversa
        type master;
	file "master/db.168.74.245.200";
    };
};
</PRE
>
El archivo <TT
CLASS="filename"
>master/miescuela.edu.co</TT
> sería el típico
para resolver externamente, mientras que en 
<TT
CLASS="filename"
>refleja/miescuela.edu.co</TT
> tendría los mismo nombres del
anterior pero con las direcciones de la red local. 
<TT
CLASS="filename"
>master/db.167.74.245.200</TT
> tendría datos para resolución
de nombres inversa desde fuera de la organización, por ejemplo:
<PRE
CLASS="screen"
>&#13;$TTL 1D
@ IN  SOA  @  root.localhost. (
  49   ; Serial de Zona
  1D   ; Refesco secundario
  6H   ; Retintento secundario
  2D   ; Expiración secundaria
  1D ) ; Cache de registros de recurso

@       IN      NS      cortafuegos.miescuela.edu.co.
	IN      PTR     www.miescuela.edu.co.
	IN      PTR     correo.miescuela.edu.co
	IN      PTR     ns1.miescuela.edu.co
</PRE
>
	</P
></DIV
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="referencias-dns"
>Referencias y lecturas recomendadas</A
></H2
><P
>&#13;      Sección sobre DNS de las guías Aprendiendo a aprender Linux.
      [<SPAN
CLASS="citation"
><A
HREF="b2933.htm#AA_Linux"
>AA_Linux</A
></SPAN
>]
      Referencia para administradores de BIND 9
      [<SPAN
CLASS="citation"
><A
HREF="b2933.htm#bind9arm"
>bind9arm</A
></SPAN
>].
      Ayudas para configurar Bind incluido en OpenBSD.
      Puede consultar más sobre vistas y reflexión de consultas DNS
      en <A
HREF="http://www.bind9.net/manual/bind/9.3.1/Bv9ARM.ch06.html#view_statement_grammar"
TARGET="_top"
>http://www.bind9.net/manual/bind/9.3.1/Bv9ARM.ch06.html#view_statement_grammar</A
>.
      [<SPAN
CLASS="citation"
><A
HREF="b2933.htm#openbsdDnsDhcp"
>openbsdDnsDhcp</A
></SPAN
>].
      Las siguientes páginas man:
      <SPAN
CLASS="citerefentry"
><SPAN
CLASS="refentrytitle"
>named</SPAN
>(8)</SPAN
>.
      <SPAN
CLASS="citerefentry"
><SPAN
CLASS="refentrytitle"
>dig</SPAN
>(8)</SPAN
>.
    </P
></DIV
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="x1076.htm"
ACCESSKEY="P"
>Anterior</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="book1.htm"
ACCESSKEY="H"
>Inicio</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="x1194.htm"
ACCESSKEY="N"
>Siguiente</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Control de ancho de banda</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Servidor <B
CLASS="command"
>ssh</B
></TD
></TR
></TABLE
></DIV
></BODY
></HTML
>