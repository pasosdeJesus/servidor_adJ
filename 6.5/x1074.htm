<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Ejemplo del uso de PF en una DMZ</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="La distribución Aprendiendo de Jesús como servidor y cortafuegos"
HREF="book1.htm"><LINK
REL="UP"
TITLE="Direcciones, enrutamiento, transporte y cortafuegos"
HREF="c855.htm"><LINK
REL="PREVIOUS"
TITLE="ftp-proxy: para usar ftp desde la red interna"
HREF="x1043.htm"><LINK
REL="NEXT"
TITLE="Control de ancho de banda"
HREF="x1084.htm"></HEAD
><BODY
CLASS="sect1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>La distribución Aprendiendo de Jesús como servidor y cortafuegos</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="x1043.htm"
ACCESSKEY="P"
>Anterior</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>Capítulo 4. Direcciones, enrutamiento, transporte y cortafuegos</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="x1084.htm"
ACCESSKEY="N"
>Siguiente</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="ejemplopf"
>Ejemplo del uso de PF en una DMZ</A
></H1
><P
>De las secciones anteriores resultaría un
		archivo <TT
CLASS="filename"
>/etc/pf.conf</TT
> 
(adaptado de la Guía de PF) como el siguiente:
<PRE
CLASS="screen"
>&#13;	# Recordar poner net.inet.ip.forwarding=1 and/or net.inet6.ip6.forwarding=1
	# en /etc/sysctl.conf 
	
	ext_if="dc1"  # Cambiar por interfaz externa
	int_if="dc0"  # Cambiar por interfaz interna
	
	int_ip="192.168.1.1"  # Cambiar por dirección en LAN
	ext_ip="200.93.171.42"  # Cambiar por IP pública
	
	# LAN. Segmento de red
	lan="192.168.1/24"  
	
	# Servicios que presta cortafuegos
	servicios_tcp="{ssh,domain}" 
	servicios_udp="{domain}" 
	servicios_icmp="echoreq"
	
	# Servidor interno
	serv_ip="192.168.2.2"
	servicios_serv="{ldap,smtp,www,https,imaps}"
	
	
	set block-policy return
	set loginterface $ext_if
	
	set skip on {lo enc0}
	scrub in all
	
	match out on $ext_if from !($ext_if) nat-to ($ext_if:0)
	
	block in log all 
	pass out keep state
	pass quick on { lo }
	antispoof quick for { lo $int_if }
	
	pass in on $int_if proto tcp from $lan to any port ftp
	pass out proto tcp from $ext_ip to any port 21
	
	match in on $int_if proto tcp from $lan to any port ftp rdr-to \
		127.0.0.1 port 8021
	
	pass in quick on $int_if
	
	match in on $ext_if proto tcp from any to any port 80 rdr-to \
		$serv_ip port 80
	match in on $ext_if proto tcp from any to any port 443 rdr-to \
		$serv_ip port 443
	match in on $ext_if proto tcp from any to any port 993 rdr-to \
		$serv_ip port 993
	match in on $ext_if proto tcp from any to any port smtp rdr-to \
		$serv_ip port smtp
	match in on $ext_if proto tcp from any to any port 389 rdr-to \
		$serv_ip port 389 
	
	match in on $ext_if proto tcp from any to any port 10022 rdr-to \
		$serv_ip port 22
	pass on $ext_if proto tcp from any to any port 10022 
	
	match in on $ext_if proto tcp from any to any port 10465 rdr-to \
		$serv_ip port 465
	pass on $ext_if proto tcp from any to any port 10465 
	
	
	pass in on $ext_if inet proto tcp from any to ($ext_if) \
		port $servicios_tcp keep state
	pass in on $ext_if inet proto udp from any to ($ext_if) \
		port $servicios_udp keep state
	pass in inet proto icmp all icmp-type $servicios_icmp keep state
	
	pass in on $ext_if proto tcp from any to $serv_ip port $servicios_serv \
		flags S/SA synproxy state
</PRE
>

</P
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="referencias-ejemplopf"
>Referencias y lecturas recomendadas</A
></H2
><P
>&#13;		Guía del usuario de PF 
		[<SPAN
CLASS="citation"
><A
HREF="b3073.htm#PF"
>PF</A
></SPAN
>].
  </P
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="x1043.htm"
ACCESSKEY="P"
>Anterior</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="book1.htm"
ACCESSKEY="H"
>Inicio</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="x1084.htm"
ACCESSKEY="N"
>Siguiente</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>ftp-proxy: para usar ftp desde la red interna</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="c855.htm"
ACCESSKEY="U"
>Subir</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Control de ancho de banda</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>