<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>ftp-proxy: para usar ftp desde la red interna</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="La distribución Aprendiendo de Jesús como servidor y cortafuegos"
HREF="book1.htm"><LINK
REL="UP"
TITLE="Direcciones, enrutamiento, transporte y cortafuegos"
HREF="c855.htm"><LINK
REL="PREVIOUS"
TITLE="Cortafuegos: filtrado y túneles"
HREF="x1020.htm"><LINK
REL="NEXT"
TITLE="Ejemplo del uso de PF en una DMZ"
HREF="x1074.htm"></HEAD
><BODY
CLASS="sect1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>La distribución Aprendiendo de Jesús como servidor y cortafuegos</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="x1020.htm"
ACCESSKEY="P"
>Anterior</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>Capítulo 4. Direcciones, enrutamiento, transporte y cortafuegos</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="x1074.htm"
ACCESSKEY="N"
>Siguiente</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="ftpproxy"
>ftp-proxy: para usar ftp desde la red interna</A
></H1
><P
>Las características del protocolo ftp hacen que sea difícil
	emplearlo desde una red interna con un cortafuegos que hace
	NAT.  <SPAN
CLASS="application"
>pf</SPAN
> ofrece facilidades para
	lograrlo en conjunto con el programa
	<TT
CLASS="filename"
>/usr/sbin/ftp-proxy</TT
> que redirige
	conexiones ftp a su destino y automáticamente agrega reglas a 
	<SPAN
CLASS="application"
>pf</SPAN
> que permitan la conexión.
</P
><P
>El siguiente ejemplo ejemplifica parte del archivo 
		<TT
CLASS="filename"
>/etc/pf.conf</TT
> para esto:
<PRE
CLASS="screen"
>&#13;	# En la sección nat/rdr
	pass on $int_if proto tcp from $lan to any port 21 
	match in on $int_if proto tcp from $lan to any port 21 rdr-to 127.0.0.1 port 8021
	
	# En la sección de reglas de filtrado
	pass out proto tcp from $ext_ip to any port 21
</PRE
>

</P
><DIV
CLASS="warning"
><P
></P
><TABLE
CLASS="warning"
BORDER="1"
WIDTH="100%"
><TR
><TD
ALIGN="CENTER"
><B
>Aviso</B
></TD
></TR
><TR
><TD
ALIGN="LEFT"
><P
>Para emplear <SPAN
CLASS="application"
>ftp-proxy</SPAN
> asegurese
	que entre las reglas de su cortafuegos no esté:
<PRE
CLASS="screen"
>&#13;	set skip $int_if
</PRE
>
	porque esto impediría la redirección al puerto 8021 (por defecto
	usado por ftp-proxy) del cortafuegos cuando se hacen peticiones de 
	ftp.
</P
></TD
></TR
></TABLE
></DIV
><P
>&#13;	Además de las reglas del cortafuegos (recuerde reiniciar 
	<SPAN
CLASS="application"
>pf</SPAN
>
con <B
CLASS="command"
>pfctl -f /etc/pf.conf</B
> para que surtan efecto)
debe iniciar el proxy con:
<PRE
CLASS="screen"
>&#13;	/usr/sbin/ftp-proxy
</PRE
>
y para que se efectúe en cada arranque del servidor agregar
a <TT
CLASS="filename"
>/etc/rc.conf.local</TT
>:
<PRE
CLASS="screen"
>&#13;	ftpproxy_flags=""
</PRE
>
</P
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="referencias-ftpproxy"
>Referencias y lecturas recomendadas</A
></H2
><P
>&#13;	Las siguientes páginas man:
	<SPAN
CLASS="citerefentry"
><SPAN
CLASS="refentrytitle"
>ftp-proxy</SPAN
>(8)</SPAN
>,
	<SPAN
CLASS="citerefentry"
><SPAN
CLASS="refentrytitle"
>pf</SPAN
>(4)</SPAN
>.
	</P
><P
>&#13;		Guía del usuario de PF 
		[<SPAN
CLASS="citation"
><A
HREF="b3057.htm#PF"
>PF</A
></SPAN
>].
  </P
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="x1020.htm"
ACCESSKEY="P"
>Anterior</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="book1.htm"
ACCESSKEY="H"
>Inicio</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="x1074.htm"
ACCESSKEY="N"
>Siguiente</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Cortafuegos: filtrado y túneles</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="c855.htm"
ACCESSKEY="U"
>Subir</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Ejemplo del uso de PF en una DMZ</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>