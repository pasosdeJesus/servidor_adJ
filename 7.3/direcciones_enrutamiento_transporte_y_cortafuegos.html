<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>4. Direcciones, enrutamiento, transporte y cortafuegos</title><meta name="generator" content="DocBook XSL Stylesheets V1.68.1"><link rel="start" href="index.html" title="La distribución Aprendiendo de Jesús como servidor y cortafuegos"><link rel="up" href="index.html" title="La distribución Aprendiendo de Jesús como servidor y cortafuegos"><link rel="prev" href="dispositivos_de_interconexion.html" title="3. Dispositivos de interconexión"><link rel="next" href="protocolos_de_soporte_y_de_usuario.html" title="5. Protocolos de soporte y de usuario"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">4. Direcciones, enrutamiento, transporte y cortafuegos</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="dispositivos_de_interconexion.html">Anterior</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="protocolos_de_soporte_y_de_usuario.html">Siguiente</a></td></tr></table><hr></div><div class="sect1" lang="es"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="direcciones_enrutamiento_transporte_y_cortafuegos"></a>4. Direcciones, enrutamiento, transporte y cortafuegos</h2></div></div></div><div class="sect2" lang="es"><div class="titlepage"><div><div><h3 class="title"><a name="ipv4"></a>4.1. Introducción a TCP/IPv4</h3></div></div></div><p>
      En una red TCP/IPv4, cada computador tiene como identificación una
      dirección IP única. Esta dirección consta de 32 bits, y suele
      escribirse como 4 números/bytes separando unos de otros por punto
      (cada uno es un número entre 0 y 255), por ejemplo 66.35.250.209.
      Cómo TCP/IP se diseño para interconectar redes, una dirección IP
      consta de una parte que identifica de forma única la red y otra
      que identifica de forma única el computador dentro de la red. Una
      máscara de red determina que parte identifica la red y cuáles
      computadores en la red puede denotarse con el número de bits del
      comienzo de la dirección que identifican la red (e.g 16 si los
      primeros 16 bits identifican la red) o como otra dirección que al
      hacer la operación lógica y con la dirección IP dará la dirección
      de red (por ejemplo 255.255.0.0 es una máscara que indica que los
      primeros 16 bits de una dirección IP son la dirección de red).
    </p><p>
      mascara de red Indica que parte de una dirección IP corresponde a
      la dirección de red.
    </p><p>
      Al diseñar una red debe escogerse una dirección de red junto con
      la máscara de acuerdo al número de computadores, algunas
      posibilidades son:
    </p><div class="variablelist"><dl><dt><span class="term">
          /8 o 255.0.0.0
        </span></dt><dd><p>
            16777216 computadores
          </p></dd><dt><span class="term">
          /12 o 255.242.0.0
        </span></dt><dd><p>
            1048576 computadores
          </p></dd><dt><span class="term">
          /16 o 255.255.0.0
        </span></dt><dd><p>
            65536 computadores
          </p></dd><dt><span class="term">
          /24 o 255.255.255.0
        </span></dt><dd><p>
            255 computadores
          </p></dd></dl></div><p>
      Cuantos computadores pueden instalarse en una red con mascara de
      red /24 o 255.255.255.0.
    </p><p>
      Además la dirección de red que escoja debe ser única para no
      producir conflictos con otras redes en caso de conectarse a
      Internet y puede facilitar la interconexión de diversas redes y el
      enrutamiento al interior de una organización. La labor de
      asignación de direcciones IP en una red local la puede hacer un
      administrador de red o puede hacerse dinámicamente con el
      protocolo DHCP.
    </p><p>
      Para facilitar la adopción de redes TCP/IPv4 en organizaciones, el
      RFC 1918 destinó algunas direcciones de red para usar al interior
      de organizaciones (no puede haber computadores en Internet con
      esas direcciones):
    </p><div class="variablelist"><dl><dt><span class="term">
          10.0.0.0 - 10.255.255.255
        </span></dt><dd><p>
            máscara /8
          </p></dd><dt><span class="term">
          172.16.0.0 - 172.31.255.255
        </span></dt><dd><p>
            máscara /12
          </p></dd><dt><span class="term">
          192.168.0.0 - 192.168.255.255
        </span></dt><dd><p>
            máscara /16
          </p></dd></dl></div><p>
      Por ejemplo en su red local puede emplear direcciones entre
      192.168.1.1 y 192.168.1.255 con máscara de red /24 o
      255.255.255.0. O en caso de contar con más redes en la misma
      organización, la segunda con direcciones entre 192.168.2.1 y
      192.168.2.255 y así sucesivamente. Además de usar direcciones
      privadas, se facilita el crecimiento de la infraestructura de
      redes y la configuración del enrutamiento entre unas y otras.
    </p><div class="sect3" lang="es"><div class="titlepage"><div><div><h4 class="title"><a name="tabla-enrutamiento"></a>4.1.1. Tabla de Enrutamiento</h4></div></div></div><p>
        Como se presentó en la descripción de las capas en redes TCP/IP
        (ver <a href="redes_protocolos_e_internet.html" title="2. Redes, protocolos e Internet">Sección 2, “Redes, protocolos e Internet”</a>),
        el protocolo IP mantiene una tabla de enrutamiento que asocia
        direcciones de red con compuertas, es decir con computadores
        conectados a la misma red que pueden retransmitir información a
        la red destino. En una red de área local no es necesario
        configurarla, pero si se requiere por ejemplo para interconectar
        varias redes de área local en una misma organización.
      </p><p>
        Puede ver la tabla de enrutamiento estático en con
        <code class="literal">route -n show</code> o con
        <code class="literal">netstat -r</code>. Entre los campos de cada entrada
        de esta tabla están: red destino, puerta de enlace, banderas,
        uso, MTU, interfaz por la cual enviar/recibir paquetes con ese
        destino,
      </p><p>
        Hay un destino por defecto (<code class="literal">default</code>) al que
        se envía todo paquete que no tiene un destino en la tabla de
        enrutamiento. Este destino por defecto o puerta de enlace se
        configura en el archivo <code class="literal">/etc/mygate</code>. En una
        red local conectada a Internet, el servidor debe emplear como
        puerta de enlace la que le haya dado el proveedor de Internet, y
        cada computador de la red local debe emplear la IP del servidor.
      </p><p>
        De requerirse pueden agregarse compuertas con
        <code class="literal">route add</code> por ejemplo, para agregar una ruta
        a la red 192.168.2.0/24 usando como compuerta 192.168.1.60 que
        está en la misma red:
      </p><pre class="programlisting">
    doas route add 192.168.2/24 192.168.1.60
</pre><p>
        Y pueden eliminarse de forma análoga con
        <code class="literal">route       delete</code>.
      </p><p>
        Para determinar problemas de enrutamiento o en general de la
        red, puede emplear algunas herramientas de diagnóstico por
        ejemplo:
      </p><div class="variablelist"><dl><dt><span class="term">
            <code class="literal">traceroute</code>
          </span></dt><dd><p>
              Presenta las direcciones de los computadores y enrutadores
              que transmiten un paquete hasta llegar a su destino. Por
              ejemplo
            </p><pre class="programlisting">
traceroute 192.168.2.2
</pre><p>
              traceroute Este programa permite rastrear la ruta que
              sigue un paquete para llegar a su destino.
            </p></dd><dt><span class="term">
            <code class="literal">netstat -s</code>
          </span></dt><dd><p>
              Éste presenta estadísticas sobre IP, ICMP y TCP
            </p></dd><dt><span class="term">
            <code class="literal">arp -an</code>
          </span></dt><dd><p>
              Que presenta direcciones MAC junto con IPs asociadas
            </p></dd><dt><span class="term">
            <code class="literal">tcpdump</code>
          </span></dt><dd><p>
              Permite analizar el tráfico de una red TCP/IP. Desde la
              cuenta root puede usarse este programa para examinar todo
              el tráfico que circule por una red. Por ejemplo para
              verificar lo que se transmite por la interfaz re0:
            </p><pre class="programlisting">
doas tcpdump -i re0 -n -ttt
</pre></dd></dl></div></div><div class="sect3" lang="es"><div class="titlepage"><div><div><h4 class="title"><a name="pf"></a>4.1.2. Otros aspectos de configuración de redes en OpenBSD</h4></div></div></div><p>
        Fuera de las tablas de enrutamiento y ARP, la funcionalidad de
        redes a nivel de kernel se puede controlar con:
      </p><div class="variablelist"><dl><dt><span class="term">
            <code class="literal">/etc/hosts</code>
          </span></dt><dd><p>
              En este archivo se listan nombres asociados a la dirección
              IP de algunos computadores, por ejemplo:
            </p><pre class="programlisting">
127.0.0.1       localhost
192.168.1.1    Jesus.miong.org Jesus
</pre></dd><dt><span class="term">
            <code class="literal">sysctl</code>
          </span></dt><dd><p>
              Para configurar algunas variables del kernel relacionadas
              con redes. Los cambios pueden hacerse permanentes
              modificando el archivo
              <code class="literal">/etc/sysctl.conf</code>. Resaltamos la
              variable <code class="literal">net.inet.ip.forwarding</code> que
              debe activarse para que un sistema opere como enrutador.
            </p></dd><dt><span class="term">
            <code class="literal">pf</code>
          </span></dt><dd><p>
              Que permite controlar el tráfico de paquetes en el kernel
              y por tanto controlar la funcionalidad de
              cortafuegos<sup>[<a name="idp3259621144" href="#ftn.idp3259621144">23</a>]</sup>. Se configura de manera permanente en el
              archivo <code class="literal">/etc/pf.conf</code> (o el archivo
              especificado en la variable <code class="literal">pf_rules</code> de
              <code class="literal">rc.conf.local</code> o
              <code class="literal">rc.conf</code>). Para que
              <code class="literal">pf</code> entre en operación en cada arranque
              del sistema, agregue a <code class="literal">rc.conf.local</code> la
              línea:
            </p><pre class="programlisting">
pf=""
</pre><p>
              Una vez esté operando si hace cambios al archivo de
              configuración puede lograr que reinicie y vuelva a leerlo
              con:
            </p><pre class="programlisting">
doas pfctl -f /etc/pf.conf
</pre><p>
              El archivo de configuración
              <code class="literal">/etc/pf.conf</code> tiene una sintaxis
              bastante entendible que permite definir variables y
              tablas.
            </p></dd></dl></div><p>
        Las secciones de este capítulo explican algunas configuraciones
        típicas que pueden hacerse con pf y los correspondientes cambios
        a su archivo de configuración.
      </p></div></div><div class="sect2" lang="es"><div class="titlepage"><div><div><h3 class="title"><a name="nat"></a>4.2. NAT (Network Address Translation)</h3></div></div></div><p>
      Puede emplear NAT para que un computador conectado a una red
      privada y que se conecte a Internet, sea pasarela de los
      computadores de la red interna y así estos puedan emplear
      Internet.
    </p><p>
      Para activarlo debe estar corriendo <code class="literal">pf</code> (como se
      explica al comienzo de este capítulo) y debe activar reenvío de IP
      con:
    </p><pre class="programlisting">
    doas sysctl -w net.inet.ip.forwarding=1
</pre><p>
      o mejor aún de manera más permanente verificando que el archivo
      <code class="literal">/etc/sysctl.conf</code> tenga la línea:
    </p><pre class="programlisting">
    net.inet.ip.forwarding=1    
</pre><p>
      Como el computador que hará NAT debe tener dos interfaces de red
      una para conectarlo a la red interna (con IP de la red interna) y
      otra para conectarlo a Internet (con IP pública). En el archivo
      <code class="literal">/etc/pf.conf</code> configure las variables
      <code class="literal">ext_if</code> e <code class="literal">int_if</code> con los
      nombres de las interfaces externa (conectada a Internet) e interna
      respectivamente (verifíquelas antes con
      <code class="literal">ifconfig</code>). Por ejemplo un archivo de
      configuración mínimo que hace NAT, suponiendo que la interfaz
      interna es <code class="literal">fxp0</code> y la externa es
      <code class="literal">nfe0</code> es:
    </p><pre class="programlisting">
    int_if="fxp0"
    ext_if="nfe0"
    
    set skip on lo
    
    match out on $ext_if from !($ext_if) nat-to ($ext_if:0)
pass out on $ext_if proto {icmp, tcp, udp} all keep state

    pass in quick on $int_if
</pre><p>
      Esta configuración podría cargarse con:
    </p><pre class="programlisting">
    doas pfctl -f /etc/pf.conf.
</pre><p>
      NAT es sigla de “<span class="quote">Network Address Translation</span>”
      (Traducción de direcciones de red) lo que hace es
      “<span class="quote">traducir</span>” las direcciones privadas de la red interna
      a la dirección pública del cortafuegos para que el cortafuegos
      haga la petición a su nombre y la respuesta que reciba la vuelve a
      traducir a la dirección privada en la red interna para enviarla al
      computador de la red interna que corresponde.
    </p><p>
      Una vez realizada, un computador en la red interna debería poder
      ejecutar
    </p><pre class="programlisting">
    ping 8.8.8.8 
</pre><p>
      y recibir respuesta.
    </p><p>
      Mientras se hace el ping en en computador de la red interna, si en
      el cortafuegos se examinara el tráfico de la interfaz interna:
    </p><pre class="programlisting">
    doas tcpdump -i fxp0 -n host 8.8.8.8
</pre><p>
      Se verían peticiones como
    </p><pre class="programlisting">
    07:09:59.262358 192.168.44.93 &gt; 8.8.8.8: icmp: echo request (DF)
</pre><p>
      y al examinar en otra terminal el tráfico de la interfaz conectada
      a Internet
      (<code class="literal">doas tcpdump -i nfe0 -n host 8.8.8.8</code>) se
      verían las mismas peticiones pero con la dirección traducida, por
      ejemplo:
    </p><pre class="programlisting">
    07:09:59.262414 182.188.122.211 &gt; 8.8.8.8: icmp: echo request (DF)
</pre><p>
      Las respuestas en la interfaz externa se verían como:
    </p><pre class="programlisting">
    07:09:59.359408 8.8.8.8 &gt; 182.188.122.211: icmp: echo reply
</pre><p>
      y en la interfaz interna se vería nuevamente traducidas como:
    </p><pre class="programlisting">
    07:09:59.359474 8.8.8.8 &gt; 192.168.44.93: icmp: echo reply
</pre><div class="sect3" lang="es"><div class="titlepage"><div><div><h4 class="title"><a name="referencias-nat"></a>4.2.1. Referencias y lecturas recomendadas</h4></div></div></div><p>
        Las siguientes páginas man: pf 4, pfctl 4.
      </p><p>
        Guía del usuario de PF <a href="biblio.html" title="B. Bibliografía">PF</a>.
      </p></div></div><div class="sect2" lang="es"><div class="titlepage"><div><div><h3 class="title"><a name="cortafuegos"></a>4.3. Cortafuegos: filtrado y túneles</h3></div></div></div><p>
      Un cortafuegos permite filtrar tráfico que puede llegar o salir a
      un computador conectado a una red como Internet.
    </p><p>
      El siguiente ejemplo muestra parte del archivo
      <code class="literal">/etc/pf.conf</code> para que permita toda conexión que
      salga de la red privada hacia Internet, y para que bloquee toda
      conexión que llegue excepto tráfico TCP por los puertos para ssh
      (22) y dns (53), también permite llegada de tráfico UDP por el
      puerto 53 y tráfico ICMP (para responder <code class="literal">ping</code>).
      Suponemos que ya se han configurado las variables
      <code class="literal">int_if</code> y <code class="literal">ext_if</code> con las
      interfaces de red interna y externa respectivamente:
    </p><pre class="programlisting">
    servicios_tcp="{ssh,domain}"
    servicios_udp="{domain}"
    servicios_icmp="echoreq"

    block in log all
    pass out keep state

    pass quick on { lo $int_if }
    antispoof quick for { lo $int_if }

    pass in on $ext_if inet proto tcp from any to ($ext_if) \
    port $servicios_tcp keep state
    pass in on $ext_if inet proto udp from any to ($ext_if) \
    port $servicios_udp keep state
    pass in inet proto icmp all icmp-type $servicios_icmp keep state
</pre><p>
      Si tiene un servidor interno (por ejemplo en una DMZ con IP
      192.168.2.2) y necesita que este preste servicios visibles al
      exterior como: web (80), https (443), imaps (993), smtp (25) y
      ldap (389), deberá establecer un túnel para cada uno de estos
      puertos, de forma que las conexiones que lleguen al cortafuegos
      sean redirigidas al servidor interno. El siguiente ejemplo
      presenta como puede hacerse:
    </p><pre class="programlisting">
    serv_ip="192.168.2.2"
    servicios_serv="{ldap,smtp,www,https,imaps, 389}"

    match in on $ext_if proto tcp from any to any port www rdr-to $serv_ip port www
    match in on $ext_if proto tcp from any to any port https rdr-to $serv_ip port https
    match in on $ext_if proto tcp from any to any port 993 rdr-to $serv_ip port 993
    match in on $ext_if proto tcp from any to any port smtp rdr-to $serv_ip port smtp
    match in on $ext_if proto tcp from any to any port 389 rdr-to $serv_ip port 389


    pass in on $ext_if proto tcp from any to $serv_ip port $servicios_serv \
    flags S/SA synproxy state
</pre><div class="sect3" lang="es"><div class="titlepage"><div><div><h4 class="title"><a name="referencias-cortafuegos"></a>4.3.1. Referencias y lecturas recomendadas</h4></div></div></div><p>
        Las siguientes páginas man: pf 4, pfctl 4.
      </p><p>
        Guía del usuario de PF <a href="biblio.html" title="B. Bibliografía">PF</a>.
      </p></div></div><div class="sect2" lang="es"><div class="titlepage"><div><div><h3 class="title"><a name="ftpproxy"></a>4.4. ftp-proxy: para usar ftp desde la red interna</h3></div></div></div><p>
      Las características del protocolo ftp hacen que sea difícil
      emplearlo desde una red interna con un cortafuegos que hace NAT.
      pf ofrece facilidades para lograrlo en conjunto con el programa
      <code class="literal">/usr/sbin/ftp-proxy</code> que redirige conexiones ftp
      a su destino y automáticamente agrega reglas a pf que permitan la
      conexión.
    </p><p>
      El siguiente ejemplo ejemplifica parte del archivo
      <code class="literal">/etc/pf.conf</code> para esto:
    </p><pre class="programlisting">
    # En la sección nat/rdr
    pass on $int_if proto tcp from $lan to any port 21 
    match in on $int_if proto tcp from $lan to any port 21 rdr-to 127.0.0.1 port 8021
    
    # En la sección de reglas de filtrado
    pass out proto tcp from $ext_ip to any port 21
</pre><div class="blockquote"><blockquote class="blockquote"><p>
        <span class="strong"><strong>Advertencia</strong></span>
      </p><p>
        Para emplear ftp-proxy asegúrese que entre las reglas de su
        cortafuegos no esté:
      </p><pre class="programlisting">
    set skip $int_if
</pre><p>
        porque esto impediría la redirección al puerto 8021 (por defecto
        usado por ftp-proxy) del cortafuegos cuando se hacen peticiones
        de ftp.
      </p></blockquote></div><p>
      Además de las reglas del cortafuegos (recuerde reiniciar pf con
      <code class="literal">pfctl -f /etc/pf.conf</code> para que surtan efecto)
      debe iniciar el proxy con:
    </p><pre class="programlisting">
    /usr/sbin/ftp-proxy
</pre><p>
      y para que se efectúe en cada arranque del servidor agregar a
      <code class="literal">/etc/rc.conf.local</code>:
    </p><pre class="programlisting">
    ftpproxy_flags=""
</pre><div class="sect3" lang="es"><div class="titlepage"><div><div><h4 class="title"><a name="referencias-ftpproxy"></a>4.4.1. Referencias y lecturas recomendadas</h4></div></div></div><p>
        Las siguientes páginas man: ftp-proxy 8, pf 4.
      </p><p>
        Guía del usuario de PF <a href="biblio.html" title="B. Bibliografía">PF</a>.
      </p></div></div><div class="sect2" lang="es"><div class="titlepage"><div><div><h3 class="title"><a name="ejemplopf"></a>4.5. Ejemplo del uso de PF en una DMZ</h3></div></div></div><p>
      De las secciones anteriores resultaría un archivo
      <code class="literal">/etc/pf.conf</code> (adaptado de la Guía de PF) como
      el siguiente:
    </p><pre class="programlisting">
    # Recordar poner net.inet.ip.forwarding=1 and/or net.inet6.ip6.forwarding=1
    # en /etc/sysctl.conf 
    
    ext_if="dc1"  # Cambiar por interfaz externa
    int_if="dc0"  # Cambiar por interfaz interna
    
    int_ip="192.168.1.1"  # Cambiar por dirección en LAN
    ext_ip="200.93.171.42"  # Cambiar por IP pública
    
    # LAN. Segmento de red
    lan="192.168.1/24"  
    
    # Servicios que presta cortafuegos
    servicios_tcp="{ssh,domain}" 
    servicios_udp="{domain}" 
    servicios_icmp="echoreq"
    
    # Servidor interno
    serv_ip="192.168.2.2"
    servicios_serv="{ldap,smtp,www,https,imaps}"
    
    
    set block-policy return
    set loginterface $ext_if
    
    set skip on {lo enc0}
    scrub in all
    
    match out on $ext_if from !($ext_if) nat-to ($ext_if:0)
    
    block in log all 
    pass out keep state
    pass quick on { lo }
    antispoof quick for { lo $int_if }
    
    pass in on $int_if proto tcp from $lan to any port ftp
    pass out proto tcp from $ext_ip to any port 21
    
    match in on $int_if proto tcp from $lan to any port ftp rdr-to \
        127.0.0.1 port 8021
    
    pass in quick on $int_if
    
    match in on $ext_if proto tcp from any to any port 80 rdr-to \
        $serv_ip port 80
    match in on $ext_if proto tcp from any to any port 443 rdr-to \
        $serv_ip port 443
    match in on $ext_if proto tcp from any to any port 993 rdr-to \
        $serv_ip port 993
    match in on $ext_if proto tcp from any to any port smtp rdr-to \
        $serv_ip port smtp
    match in on $ext_if proto tcp from any to any port 389 rdr-to \
        $serv_ip port 389 
    
    match in on $ext_if proto tcp from any to any port 10022 rdr-to \
        $serv_ip port 22
    pass on $ext_if proto tcp from any to any port 10022 
    
    match in on $ext_if proto tcp from any to any port 10465 rdr-to \
        $serv_ip port 465
    pass on $ext_if proto tcp from any to any port 10465 
    
    
    pass in on $ext_if inet proto tcp from any to ($ext_if) \
        port $servicios_tcp keep state
    pass in on $ext_if inet proto udp from any to ($ext_if) \
        port $servicios_udp keep state
    pass in on $ext_if inet proto icmp all icmp-type 8 code 0 # permite ping


    pass in on $ext_if proto tcp from any to $serv_ip port $servicios_serv \
        flags S/SA synproxy state
</pre><div class="sect3" lang="es"><div class="titlepage"><div><div><h4 class="title"><a name="referencias-ejemplopf"></a>4.5.1. Referencias y lecturas recomendadas</h4></div></div></div><p>
        Guía del usuario de PF <a href="biblio.html" title="B. Bibliografía">PF</a>.
      </p></div></div><div class="sect2" lang="es"><div class="titlepage"><div><div><h3 class="title"><a name="control-de-ancho-de-banda"></a>4.6. Control de ancho de banda</h3></div></div></div><p>
      El siguiente ejemplo presenta cómo puede configurarse un servidor
      NAT para controlar ancho de banda de diversos computadores de la
      red interna. La conexión de la red interna es a 100MB, mientras
      que la conexión a Internet es de 300KB. De todos los computadores
      de la red interna el ancho de banda se limita sólo a 4
      computadores, cada uno máximo 30KB. Los demás comparten el resto
      del ancho de banda.
    </p><pre class="programlisting">
    table &lt;interna&gt; {192.168.2.2, 192.168.2.1, 192.168.1.1, 192.168.1.8, 192.168.1.21, 192.168.1.23, 192.168.1.30, 192.168.1.31, 192.168.1.37, 192.168.1.40, 192.168.1.41, 192.168.1.42, 192.168.1.43, 192.168.1.95, 192.168.1.70}
    
    set loginterface $int_if
    set fingerprints "/etc/pf.os"
    
    altq on $int_if bandwidth 100Mb cbq queue { dflt_in, uext1_in, uext2_in, uext3_in, uext4_in}
    altq on $ext_if bandwidth 300Kb cbq queue { dflt_out }
    
    queue dflt_in cbq(default) bandwidth 80%
    queue dflt_out cbq(default)
    
    queue uext1_in bandwidth 30Kb
    queue uext2_in bandwidth 30Kb
    queue uext3_in bandwidth 30Kb
    queue uext4_in bandwidth 30Kb
    
    uext1="192.168.1.70" 
    uext2="192.168.1.23" 
    uext3="192.168.1.95"
    uext4="192.168.1.30"
    
    match out on $ext_if from &lt;interna&gt; to any nat-to ($ext_if)
    
    pass  out on $int_if from any to $uext1 queue uext1_in
    pass  out on $int_if from any to $uext2 queue uext2_in
    pass  out on $int_if from any to $uext3 queue uext3_in
    pass  out on $int_if from any to $uext4 queue uext4_in
</pre><div class="sect3" lang="es"><div class="titlepage"><div><div><h4 class="title"><a name="referencias-control-ancho-banda"></a>4.6.1. Referencias y lecturas recomendadas</h4></div></div></div><p>
        Las siguientes páginas man: pf 4, pfctl 4.
      </p><p>
        Guía del usuario de PF <a href="biblio.html" title="B. Bibliografía">PF</a>.
      </p></div></div><div class="footnotes"><br><hr width="100" align="left"><div class="footnote"><p xmlns="http://www.w3.org/TR/xhtml1/transitional"><sup>[<a name="ftn.idp3259621144" href="#idp3259621144">23</a>] </sup>
                  Cortafuego del inglés <span xmlns="" class="emphasis"><em>firewall</em></span>
                </p></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="dispositivos_de_interconexion.html">Anterior</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="protocolos_de_soporte_y_de_usuario.html">Siguiente</a></td></tr><tr><td width="40%" align="left" valign="top">3. Dispositivos de interconexión </td><td width="20%" align="center"><a accesskey="h" href="index.html">Inicio</a></td><td width="40%" align="right" valign="top"> 5. Protocolos de soporte y de usuario</td></tr></table></div></body></html>
